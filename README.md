# è±†ç“£ä¹¦å•åŒæ­¥ä¸ Calibre é›†æˆè‡ªåŠ¨åŒ–

![Python Version](https://img.shields.io/badge/python-3.8%2B-blue)
![License](https://img.shields.io/badge/license-MIT-green)

## é¡¹ç›®ç®€ä»‹

ã€Œè±†ç“£ä¹¦å•åŒæ­¥ä¸ Calibre é›†æˆè‡ªåŠ¨åŒ–ã€æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·ï¼Œç”¨äºå°†è±†ç“£ã€Œæƒ³è¯»ã€ä¹¦å•ä¸­çš„ä¹¦ç±è‡ªåŠ¨ä¸‹è½½å¹¶æ·»åŠ åˆ° Calibre ä¹¦åº“ä¸­ã€‚ç³»ç»Ÿä¼šå®šæœŸæ£€æŸ¥è±†ç“£ä¹¦å•æ›´æ–°ï¼Œé€šè¿‡ Z-Library ä¸‹è½½ç”µå­ä¹¦ï¼Œå¹¶è‡ªåŠ¨ä¸Šä¼ åˆ° Calibre ä¹¦åº“ï¼Œæœ€åé€šè¿‡é£ä¹¦æœºå™¨äººå‘é€é€šçŸ¥ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- **è±†ç“£ä¹¦å•åŒæ­¥**ï¼šè‡ªåŠ¨çˆ¬å–è±†ç“£ã€Œæƒ³è¯»ã€ä¹¦å•
- **Calibre ä¹¦åº“æŸ¥è¯¢**ï¼šæ£€æŸ¥ä¹¦ç±æ˜¯å¦å·²åœ¨ Calibre ä¹¦åº“ä¸­
- **Z-Library ä¸‹è½½**ï¼šä» Z-Library æœç´¢å¹¶ä¸‹è½½ç”µå­ä¹¦
- **Calibre ä¸Šä¼ **ï¼šå°†ä¸‹è½½çš„ç”µå­ä¹¦ä¸Šä¼ åˆ° Calibre ä¹¦åº“
- **é£ä¹¦é€šçŸ¥**ï¼šé€šè¿‡é£ä¹¦æœºå™¨äººå‘é€ä»»åŠ¡æ‰§è¡Œç»“æœ
- **å®šæ—¶è°ƒåº¦**ï¼šæ”¯æŒå®šæ—¶æ‰§è¡ŒåŒæ­¥ä»»åŠ¡

## ç³»ç»Ÿæ¶æ„

![ç³»ç»Ÿæ¶æ„å›¾](docs/images/architecture.svg)

```mermaid
flowchart TD
A[ğŸŸ¢ å¯åŠ¨è‡ªåŠ¨ä»»åŠ¡ï¼ˆå®šæ—¶å™¨ï¼‰] --> B[ğŸ” çˆ¬å–è±†ç“£ã€Œæƒ³è¯»ã€ä¹¦å•<br>ï¼ˆä½¿ç”¨ç”¨æˆ· Cookieï¼‰]

B --> C{ğŸ“š æœ¬åœ°æ•°æ®åº“ä¸­æ˜¯å¦å·²å­˜åœ¨ï¼Ÿ}
C -- å¦ --> D[ğŸ“ æ·»åŠ åˆ°æœ¬åœ°æ•°æ®åº“]
C -- æ˜¯ --> E[â© è·³è¿‡ï¼Œå·²å­˜åœ¨]

D --> F[ğŸ” æ£€æŸ¥ Calibre å†…å®¹æœåŠ¡å™¨<br>æ˜¯å¦å·²æœ‰è¯¥ä¹¦]
E --> F

F --> G{ğŸ“– Calibre ä¸­æ˜¯å¦å·²æœ‰ï¼Ÿ}
G -- æ˜¯ --> H[âœ… æ›´æ–°çŠ¶æ€ä¸ºã€Œå·²å­˜åœ¨ã€<br>è®°å½•æ¥æºä¸º Calibre]
G -- å¦ --> I[ğŸ“¥ ä½¿ç”¨ Z-Library æœç´¢ä¸‹è½½<br>ï¼ˆé€šè¿‡ API ç™»å½•ï¼‰]

I --> J{ğŸ”¤ åŒ¹é…åº¦æ˜¯å¦è¶³å¤Ÿé«˜ï¼Ÿ}
J -- å¦ --> K[âš ï¸ è·³è¿‡ï¼Œè®°å½•ä¸ºã€ŒæœªåŒ¹é…ã€]
J -- æ˜¯ --> L[ğŸ“‚ ä¸‹è½½ä¼˜å…ˆæ ¼å¼<br>ï¼ˆepub > mobi > pdfï¼‰]

L --> M[ğŸ“¤ ä¸Šä¼ è‡³ Calibre å†…å®¹æœåŠ¡å™¨<br>ï¼ˆé€šè¿‡æ¥å£ï¼‰]
M --> N[ğŸŸ© æ›´æ–°æ•°æ®åº“çŠ¶æ€ä¸ºã€Œå·²ä¸Šä¼ ã€]

subgraph é€šçŸ¥ç³»ç»Ÿ
  N --> O[ğŸ“§ å‘é€ Log åˆ°é£ä¹¦<br>ï¼ˆé€šè¿‡ larkpyï¼‰]
  K --> O
  H --> O
end

```

ç³»ç»Ÿç”±ä»¥ä¸‹æ¨¡å—ç»„æˆï¼š

1. **æ•°æ®é‡‡é›†æ¨¡å—**ï¼šè´Ÿè´£ä»è±†ç“£ç½‘ç«™çˆ¬å–ã€Œæƒ³è¯»ã€ä¹¦å•
2. **æ•°æ®åº“æ¨¡å—**ï¼šå­˜å‚¨ä¹¦ç±ä¿¡æ¯å’Œå¤„ç†çŠ¶æ€
3. **Calibre æŸ¥è¯¢æ¨¡å—**ï¼šæŸ¥è¯¢ Calibre ä¹¦åº“ä¸­æ˜¯å¦å·²æœ‰ç›¸åº”ä¹¦ç±
4. **Z-Library ä¸‹è½½æ¨¡å—**ï¼šä» Z-Library æœç´¢å¹¶ä¸‹è½½ç”µå­ä¹¦
5. **Calibre ä¸Šä¼ æ¨¡å—**ï¼šå°†ç”µå­ä¹¦ä¸Šä¼ åˆ° Calibre ä¹¦åº“
6. **é£ä¹¦é€šçŸ¥æ¨¡å—**ï¼šå‘é€ä»»åŠ¡æ‰§è¡Œç»“æœé€šçŸ¥
7. **è°ƒåº¦ç³»ç»Ÿ**ï¼šç®¡ç†å®šæ—¶ä»»åŠ¡ï¼Œåè°ƒå„æ¨¡å—å·¥ä½œ

## å®‰è£…æŒ‡å—

### ç³»ç»Ÿè¦æ±‚

- Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- Calibre 5.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œå¹¶å¯ç”¨ Content Server
- ç¨³å®šçš„ç½‘ç»œè¿æ¥
- è±†ç“£è´¦å·
- Z-Library è´¦å·
- é£ä¹¦æœºå™¨äººï¼ˆå¯é€‰ï¼‰

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**

   ```bash
   git clone https://github.com/yourusername/douban-zlib.git
   cd douban-zlib
   ```

2. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**

   ```bash
   # ä½¿ç”¨ venv
   python -m venv venv
   
   # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
   # Windows
   venv\Scripts\activate
   # macOS/Linux
   source venv/bin/activate
   ```

3. **å®‰è£…ä¾èµ–**

   ```bash
   pip install -r requirements.txt
   ```

4. **é…ç½®ç³»ç»Ÿ**

   å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿å¹¶ç¼–è¾‘ï¼š

   ```bash
   cp config.yaml.example config.yaml
   # ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ç¼–è¾‘ config.yaml
   ```

5. **åˆå§‹åŒ–æ•°æ®åº“**

   ```bash
   # åˆ›å»ºæ•°æ®ç›®å½•
   mkdir -p data logs
   
   # åˆå§‹åŒ–æ•°æ®åº“
   python -c "from db.database import Database; db = Database('sqlite:///data/douban_books.db'); db.init_db()"
   ```

6. **å¯åŠ¨ Calibre Content Server**

   ```bash
   # å¯åŠ¨ Calibre Content Serverï¼Œæ›¿æ¢è·¯å¾„ä¸ºä½ çš„ä¹¦åº“è·¯å¾„
   calibre-server --port=8080 --username=your_username --password=your_password /path/to/your/calibre/library
   ```

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œé€‰é¡¹

```bash
# æŸ¥çœ‹å¸®åŠ©
python main.py --help

# ä½¿ç”¨æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨
python main.py --config /path/to/config.yaml

# ç«‹å³æ‰§è¡ŒåŒæ­¥ä»»åŠ¡
python main.py --run-now
```

### å®šæ—¶æ‰§è¡Œ

ç³»ç»Ÿé»˜è®¤ä¼šæŒ‰ç…§é…ç½®æ–‡ä»¶ä¸­çš„è°ƒåº¦è®¾ç½®å®šæ—¶æ‰§è¡ŒåŒæ­¥ä»»åŠ¡ã€‚ä½ å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹æ‰§è¡Œæ—¶é—´ï¼š

```yaml
schedule:
  time: "03:00"  # æ¯å¤©å‡Œæ™¨ 3 ç‚¹æ‰§è¡Œ
```

### æ—¥å¿—æŸ¥çœ‹

æ—¥å¿—æ–‡ä»¶é»˜è®¤ä¿å­˜åœ¨ `logs` ç›®å½•ä¸‹ï¼š

```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f logs/app.log
```

## é…ç½®è¯´æ˜

é…ç½®æ–‡ä»¶ `config.yaml` åŒ…å«ä»¥ä¸‹ä¸»è¦éƒ¨åˆ†ï¼š

### è±†ç“£é…ç½®

```yaml
douban:
  cookie: "your_cookie_here"  # è±†ç“£ç½‘ç«™ Cookie
  wishlist_url: "https://book.douban.com/people/me/wish"  # æƒ³è¯»ä¹¦å• URL
```

### æ•°æ®åº“é…ç½®

```yaml
database:
  type: "sqlite"  # æ•°æ®åº“ç±»å‹ï¼šsqlite æˆ– postgresql
  path: "data/douban_books.db"  # SQLite æ•°æ®åº“æ–‡ä»¶è·¯å¾„
```

### Calibre é…ç½®

```yaml
calibre:
  content_server_url: "http://localhost:8080"  # Calibre Content Server URL
  username: "admin"  # ç”¨æˆ·å
  password: "password"  # å¯†ç 
```

### Z-Library é…ç½®

```yaml
zlibrary:
  username: "your_email@example.com"  # Z-Library è´¦å·
  password: "your_password"  # å¯†ç 
  format_priority: ["epub", "mobi", "azw3", "pdf"]  # ä¸‹è½½æ ¼å¼ä¼˜å…ˆçº§
```

### è°ƒåº¦é…ç½®

```yaml
schedule:
  time: "03:00"  # æ¯æ—¥æ‰§è¡Œæ—¶é—´ï¼Œ24å°æ—¶åˆ¶
  run_at_startup: false  # æ˜¯å¦åœ¨å¯åŠ¨æ—¶ç«‹å³æ‰§è¡Œä¸€æ¬¡
```

### é£ä¹¦é€šçŸ¥é…ç½®

```yaml
lark:
  webhook_url: "https://open.feishu.cn/open-apis/bot/v2/hook/xxx"  # é£ä¹¦æœºå™¨äºº Webhook URL
  enabled: true  # æ˜¯å¦å¯ç”¨é€šçŸ¥
```

## å¼€å‘æŒ‡å—

è¯¦ç»†çš„å¼€å‘æŒ‡å—è¯·å‚è€ƒ [å¼€å‘æŒ‡å—](å¼€å‘æŒ‡å—.md) æ–‡æ¡£ï¼Œå…¶ä¸­åŒ…å«ï¼š

- å¼€å‘ç¯å¢ƒæ­å»º
- é¡¹ç›®ç»“æ„è¯´æ˜
- ä»£ç è§„èŒƒ
- æ¨¡å—å¼€å‘æŒ‡å—
- æµ‹è¯•æŒ‡å—
- éƒ¨ç½²æŒ‡å—

## ä»»åŠ¡æ‰§è¡Œè®¡åˆ’

é¡¹ç›®å®æ–½çš„è¯¦ç»†ä»»åŠ¡æ‰§è¡Œè®¡åˆ’è¯·å‚è€ƒ [ä»»åŠ¡æ‰§è¡Œè®¡åˆ’](ä»»åŠ¡æ‰§è¡Œè®¡åˆ’.md) æ–‡æ¡£ã€‚

## é¡¹ç›®ç»“æ„

é¡¹ç›®çš„è¯¦ç»†ç›®å½•ç»“æ„å’Œæ–‡ä»¶è¯´æ˜è¯·å‚è€ƒ [é¡¹ç›®ç»“æ„](é¡¹ç›®ç»“æ„.md) æ–‡æ¡£ã€‚

## é£é™©ç®¡ç†

é¡¹ç›®å®æ–½è¿‡ç¨‹ä¸­çš„é£é™©è¯†åˆ«ä¸åº”å¯¹ç­–ç•¥è¯·å‚è€ƒ [é£é™©ç®¡ç†è®¡åˆ’](é£é™©ç®¡ç†è®¡åˆ’.md) æ–‡æ¡£ã€‚

## æµ‹è¯•è®¡åˆ’

é¡¹ç›®çš„æµ‹è¯•ç­–ç•¥å’Œæµ‹è¯•ç”¨ä¾‹è¯·å‚è€ƒ [æµ‹è¯•è®¡åˆ’](æµ‹è¯•è®¡åˆ’.md) æ–‡æ¡£ã€‚

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç æˆ–æå‡ºå»ºè®®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦æƒ…è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ä»¬ï¼š

- é¡¹ç›®ç»´æŠ¤è€…ï¼š[Your Name](mailto:your.email@example.com)
- é¡¹ç›®ä»“åº“ï¼š[GitHub Issues](https://github.com/yourusername/douban-zlib/issues)