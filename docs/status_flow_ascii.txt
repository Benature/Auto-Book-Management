豆瓣Z-Library同步工具 - 状态流程图 (ASCII版本)
========================================================

正常流程：
┌─────────┐    ┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│  START  │───▶│       NEW       │───▶│ DETAIL_FETCHING  │───▶│ DETAIL_COMPLETE │
└─────────┘    └─────────────────┘    └──────────────────┘    └─────────────────┘
                                                                        │
                                                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ SEARCH_QUEUED   │◀───│  CHECK_EXISTS   │    │ SKIPPED_EXISTS  │───▶│      END        │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │
         ▼                       ▼
┌─────────────────┐    ┌─────────────────┐
│ SEARCH_ACTIVE   │    │ FAILED_PERMANENT│───┐
└─────────────────┘    └─────────────────┘   │
         │                                    │
         ▼                                    │
┌─────────────────┐    ┌─────────────────┐   │
│SEARCH_COMPLETE  │    │SEARCH_NO_RESULTS│   │
└─────────────────┘    └─────────────────┘   │
         │                       │           │
         ▼                       │           │
┌─────────────────┐              │           │
│DOWNLOAD_QUEUED  │              │           │
└─────────────────┘              │           │
         │                       │           │
         ▼                       │           │
┌─────────────────┐    ┌─────────────────┐   │
│DOWNLOAD_ACTIVE  │    │DOWNLOAD_FAILED  │   │
└─────────────────┘    └─────────────────┘   │
         │                       │           │
         ▼                       │           │
┌─────────────────┐              │           │
│DOWNLOAD_COMPLETE│              │           │
└─────────────────┘              │           │
         │                       │           │
         ▼                       │           │
┌─────────────────┐              │           │
│ UPLOAD_QUEUED   │              │           │
└─────────────────┘              │           │
         │                       │           │
         ▼                       │           │
┌─────────────────┐    ┌─────────────────┐   │
│ UPLOAD_ACTIVE   │    │ UPLOAD_FAILED   │   │
└─────────────────┘    └─────────────────┘   │
         │                       │           │
         ▼                       │           │
┌─────────────────┐              │           │
│UPLOAD_COMPLETE  │              │           │
└─────────────────┘              │           │
         │                       │           │
         ▼                       │           │
┌─────────────────┐              │           │
│   COMPLETED     │              │           │
└─────────────────┘              │           │
         │                       │           │
         ▼                       ▼           ▼
┌─────────────────────────────────────────────────┐
│                    END                          │
└─────────────────────────────────────────────────┘

Pipeline阶段映射：
==================
data_collection: NEW → DETAIL_COMPLETE
search:          SEARCH_QUEUED → SEARCH_COMPLETE/SEARCH_NO_RESULTS  
download:        DOWNLOAD_QUEUED → DOWNLOAD_COMPLETE/DOWNLOAD_FAILED
upload:          UPLOAD_QUEUED → UPLOAD_COMPLETE/UPLOAD_FAILED

豆瓣403错误特殊流程：
===================
豆瓣403 → 跳过同步 → 处理现有书籍 → data_collection(跳过详情) → 正常搜索流程

重试机制：
==========
ACTIVE状态失败 → 回退到QUEUED状态 → 指数退避重试 → 超过3次转FAILED_PERMANENT

状态类型：
==========
• 起始态：NEW
• 处理态：*_FETCHING, *_ACTIVE (临时状态)
• 完成态：*_COMPLETE (阶段完成)
• 队列态：*_QUEUED (等待处理)
• 失败态：*_FAILED (可重试), FAILED_PERMANENT (不可重试)
• 终态：COMPLETED, SKIPPED_EXISTS, FAILED_PERMANENT